---
ID: 591
post_title: 'Resilient infrastructure with consumer grade equipment &#8211; Case study in cheap'
author: Jonathan Frappier
post_date: 2013-03-20 13:26:51
post_excerpt: ""
layout: post
permalink: >
  http://www.virtxpert.com/a-case-study-in-being-cheap-resilient-infrastructure-design-using-commodity-hardware/
published: true
dsq_thread_id:
  - "1151631787"
---
Having worked with mostly smaller companies through out my career, I have noticed that most tend to spend money on their infrastructure in the wrong places (in my opinion).  I have walked into many data centers to see high end Dell or HP servers with redundancy tucked into every corner of the server only to find all the network interfaces connected to a single consumer grade (small office home office) level switch with a single power supply daisy chained to another SOHO switch (typically from a different vendor or model with different firmware or functionality) which is then connected to other network infrastructure that is also of a lower quality.  All that money spent on a really nice server, only to have it hooked up to a less than adequate infrastructure is a shame and clearly showed a lack of understanding of the business needs.  This led to an idea that I have been building in my head for some time - to build a resilient, yet cheap infrastructure with with low end commodity hardware (even from the used or refurb market) in certain areas and higher end infrastructure in others.

With <a href="http://gigaom.com/2013/03/19/the-world-is-ready-for-the-consumer-grade-enterprise/ " target="_blank">Paul Maritz's recent comments about building consumer grade enterprises</a>, and a discussion that was started on Twitter, I decided to follow the rabbit down the hole and see where I ended up.  Time (and money) will not permit me to do a real world test of the design I am writing about here, and we may even find the cost benefit is not present to "cheap out" in certain areas.  Also, as always, the designs and decisions here are not applicable in all scenarios; before embarking on any project you need to clearly understand the needs of the business, the applications its using and its use cases and SLA's (service level agreements) the business has with its customers.  For example, I would not advocate doing something like this in a hospital or financial or e-commerce organization that relies on real time transactions and high availability.  Finally, I am going to focus on just <strong>servers</strong>.  I do not believe that network infrastructure such as firewalls or switches, or the Storage Area Network (SAN) are places you should be looking to "go cheap."  There certainly may be ways to save money in those areas but going to a cheap/refurbished item should not be one of them.

For the purposes of this article, we are going to follow and (semi) fictitious company called MySoftware, Inc.  MySoftware, Inc. is a software development company that has created a web based application it plans to deliver to its customers in a Software-as-a-Service (SaaS) model.  The application is a typical multi-tier application consisting of a web front end, application middleware and database.  The data being stored in the application by the customers is HR data, about the employees of MySoftware, Inc's customers.  Since this is a multi-tenant model, the web servers for the front end web UI are load balanced and shared among all customers, no data is stored on these web servers other than basic HTML, CSS, Javascript etc... New web servers can be brought online and decommissioned with no impact on the customer by a simple change on the load balancer.  Similarly, the application tier is not storing data and has been written such that a failure to any single application node can be sustained with minimal interruption to user sessions.  The database layer is where the majority of the data processing is handled and saved when it is passed through from the application tier.

MySoftware, Inc. wants to building a highly available infrastructure but also limit costs for this infrastructure.  It has been determined that Infrastructure as a Service (IaaS or "cloud") hosting is not a viable long term option as the costs will not fit their business model long term with their projected growth and number of servers required to satisfy application and customer demand.  The infrastructure will be based on VMware vSphere Enterprise Plus and it has been determined that 18 hosts with at least quad-core 2.0GHz processors and 64GB of RAM will be sufficient for the application to run during peak times based on load testing projections and support growth over the next 12-18 months, 8 of those hosts will be dedicated to the database layer, the remaining 10 will be shared between VM's running the web and middleware layers.  Based on the VMware consultant's design, the cluster can can support the loss of between 2-6 hosts (be it unplanned downtime or maintenance) at any given time based on customer usage cycles.  The previous server consultant had suggested current model HP servers.  The owner of MySoftware, Inc. has asked you to find a way to reduce the cost associated with the implementation.

<strong>[ultimatetables 2 /]</strong>

As you can see from the table here, you can save $2470 per physical host by going for a refurbished host rather than a new host.  Obviously there are new CPU features that are available in the G8 model that are not in the G5 but if you have to cut costs, would you rather it be in a CPU feature that you may not be using or in redundancy for your switching infrastructure?  Spread across the 18 hosts you have a cost savings of $44,460.  Now based on the size of this project (18 hosts), this project should easily be pushing $250,000 if not $500,000 so I would certainly buy the argument that a savings of $45,000 is somewhat insignificant given that these servers will be running your business.

In much smaller companies, the cost savings could be much different, maybe you have a small company who only needs 4-5 hosts to run internal infrastructure, here the cost savings of $2470 per physical server (assuming we remove the FC HBA's, and keep everything the same) could easily help give you the budget for better SAN or network equipment the customer may have not otherwise had the budget for.

What do you think?  Does saving $45,000 justify buying refurbished server equipment when you have a project whose total budget is in the $500,000 range (roughly a 10% savings)?  It seems to me the cost benefit clearly goes towards the SMB, assuming the use that money in other areas.